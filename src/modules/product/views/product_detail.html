<style>
  .cursor-pointer {
    cursor: pointer;
  }

  .thumbnail-image {
    transition: all 0.3s ease;
    border: 2px solid transparent;
    padding: 5px;
  }

  .thumbnail-image:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .active-thumbnail {
    border: 1px solid var(--black) !important;
    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
  }

  .btn-navigation {
    width: 40px;
    height: 40px;
    border-radius: 50% !important;
    background-color: var(--black);
    color: var(--white);
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: all 0.3s ease;
    transform: translateY(-50%) scale(0.9);
  }

  /* Always visible on medium screens and below */
  @media (max-width: 991.98px) {
    .btn-navigation {
      opacity: 0.8 !important;
      transform: translateY(-50%) scale(1) !important;
    }
  }

  /* Show on hover for large screens */
  .main-image-container:hover .btn-navigation {
    opacity: 0.8;
    transform: translateY(-50%) scale(1);
  }

  .btn-navigation:hover {
    background-color: var(--gold);
    color: var(--black);
    opacity: 1 !important;
    transform: translateY(-50%) scale(1.1) !important;
  }

  /* Mobile responsiveness */
  @media (max-width: 767.98px) {
    .btn-navigation {
      width: 35px;
      height: 35px;
      font-size: 0.9rem;
    }
  }

  .form-check-input:checked {
    background-color: rgba(var(--bs-dark-rgb),var(--bs-text-opacity))!important;
    border-color: rgba(var(--bs-dark-rgb),var(--bs-text-opacity))!important;
  }
</style>

<section class="container my-5">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">Home</a></li>
      <li class="breadcrumb-item"><a href="/product">Product</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{product.name}}</li>
    </ol>
  </nav>

  <div class="row g-5">
    <!-- Product Image Gallery -->
    <div class="col-md-7">
      <div class="row">
        <!-- Thumbnail Gallery (hidden on mobile) -->
        <div class="col-md-3 d-none d-md-block">
          <div class="row">
            {{#each product.images}}
            <div class="col-12 mb-3">
              <img src="{{this.url}}" alt="{{product.name}} - Image {{@index}}"
                class="img-fluid container thumbnail-image cursor-pointer {{#if this.is_primary}}active-thumbnail{{/if}}"
                style="object-fit: cover; height: 150px; width: 100%;" data-full-image="{{this.url}}"
                data-image-id="{{this.id}}">
            </div>
            {{/each}}
          </div>
        </div>

        <!-- Main Image Display with Navigation -->
        <div class="col-md-9 mt-1 mb-4 position-relative main-image-container">
          <!-- Primary image or first image as default -->
          {{#with (findPrimaryOrFirst product.images) as |mainImg|}}
          <img id="main-product-image" src="{{mainImg.url}}" class="img-fluid rounded shadow" alt="{{product.name}}"
            data-image-id="{{mainImg.id}}" style="width: 100%;">
          {{/with}}

          <!-- Navigation Arrows -->
          <button class="btn btn-navigation prev-btn"
            style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); z-index: 10;">
            <i class="bi bi-chevron-left"></i>
          </button>
          <button class="btn btn-navigation next-btn"
            style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); z-index: 10;">
            <i class="bi bi-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>



    <!-- Product Info -->
    <div class="col-md-5">
      <h2 class="mb-3 fs-4 fw-light ">{{product.name}}</h2>
      <p class="text-dark fs-4 fw-light">${{product.price}}</p>

      <!-- Ratings 
      <div class="mb-3">
        <i class="bi bi-star-fill text-gold"></i>
        <i class="bi bi-star-fill text-gold"></i>
        <i class="bi bi-star-fill text-gold"></i>
        <i class="bi bi-star-fill text-gold"></i>
        <i class="bi bi-star text-gold"></i>
        <span class="ms-2 text-muted">(42 reviews)</span>
      </div>-->

      <p class="mt-3 ">{{product.short_description}}</p>

      <div class="mt-4">
        <span class="fw-bold">Available Stock:</span>
        {{#if (lte product.stock 0)}}
          <span class="text-danger">Sold Out</span>
        {{else}}
          {{product.stock}}
        {{/if}}
      </div>

      <div class="mt-4">
  <span class="fw-bold">Choose Size:</span>
  <div class="mt-2">
    {{#each product.sizes}}
      <div class="form-check">
        <input class="form-check-input text-dark" type="radio" name="selected-size" id="size-{{this.id}}" value="{{this.id}}" 
          data-stock="{{this.ProductSize.stock}}" 
          data-price="{{#if this.ProductSize.price_override}}{{this.ProductSize.price_override}}{{else}}{{../product.price}}{{/if}}"
          {{#if (lte this.ProductSize.stock 0)}}disabled{{/if}}>
        <label class="form-check-label" for="size-{{this.id}}">
          {{this.name}} — 
          {{#if this.ProductSize.price_override}}
            ${{this.ProductSize.price_override}}
          {{else}}
            ${{../product.price}}
          {{/if}}
          {{#if (lte this.ProductSize.stock 0)}} <span class="text-danger">(Out of stock)</span>{{/if}}
        </label>
      </div>
    {{/each}}
  </div>
</div>


      <!-- Quantity Controls -->
      <div class="d-grid my-4">
        <span class="fw-bold">Quantity:</span>
        <div class="row align-items-center">
          {{#if (lte product.stock 0)}}
            <!-- No quantity controls if sold out -->
            <div class="col-sm-4 p-1">
              <input type="number" class="form-control text-center w-100" value="0" disabled>
            </div>
            <button class="btn btn-dark rounded-0 btn-lg col-sm-7" disabled>
              <i class="bi bi-cart-x"></i> Sold Out
            </button>
          {{else}}
            <div class="quantity-controls col-sm-4 p-1" data-product-id="{{product.id}}">
              <div class="d-flex justify-content-between align-items-center border rounded-2 mx-1">
                <button class="btn btn-sm btn-none h-100 rounded-0 decrement-btn fs-4">-</button>
                <input type="number" class="quantity-input form-control text-center border-none rounded-0 d-inline w-50 h-100"
                  style="border: none;" value="1" min="1">
                <button class="btn btn-sm btn-none h-100 rounded-0 increment-btn fs-4">+</button>
              </div>
            </div>
            <!-- Add to Cart -->
            <button class="btn btn-dark rounded-0 btn-lg add-to-cart col-sm-7"
              data-product-price="{{product.price}}"
              data-product-id="{{product.id}}">
              <i class="bi bi-cart-plus"></i> Add to Cart
            </button>
          {{/if}}
        </div>
      </div>




      </div>

      <!-- Tabs Section -->
      <div class="row mt-5">
        <div class="col-md-12">
          <ul class="nav nav-tabs" id="productTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="desc-tab" data-bs-toggle="tab" data-bs-target="#desc"
                type="button">Description</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews"
                type="button">Reviews</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="shipping-tab" data-bs-toggle="tab" data-bs-target="#shipping"
                type="button">Shipping Info</button>
            </li>
          </ul>
          <div class="tab-content border border-top-0 p-4" id="productTabContent">
            <div class="tab-pane fade show active" id="desc" role="tabpanel">
              {{product.description}}
            </div>
            <div class="tab-pane fade" id="reviews" role="tabpanel">
              <p><strong>Olamide:</strong> “Beautifully made! Got lots of compliments at my event.” ⭐⭐⭐⭐⭐</p>
              <p><strong>Amaka:</strong> “Stitching is top-notch. Will buy again!” ⭐⭐⭐⭐</p>
            </div>
            <div class="tab-pane fade" id="shipping" role="tabpanel">
              <p>Ships within 2–4 business days. Free delivery for orders above $30,000 in Nigeria.</p>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>


</section>


{{#if product.relatedProducts}}
<section class="py-5">
  <div class="container">
    <!-- Section Header -->
    <div class="row justify-content-center align-items-end mb-5">
      <div class="col-md-12 text-center" style="font-weight: 400 !important;">
        <h2 class="display-6 mb-3">
          Related Products You may also Love
        </h2>
      </div>
    </div>
    <div class="position-relative">
      <div class="products-row row">
        {{#each product.relatedProducts}}
        <a href="/product/{{this.slug}}" class="col-lg-3 col-md-4 col-sm-6 col-12 flex-shrink-0 pe-3 mb-4">
          <div class="card h-100 border-0 shadow-0 hover-effect">
            <div class="position-relative product-image-container" style="height: 400px; overflow: hidden;">
              <!-- Main Image -->
              {{#with (findPrimaryOrFirst this.images) as |mainImg|}}
              <img src="{{mainImg.url}}" class="main-img"
                style="width:100%;height:100%;object-fit:cover;position:absolute;top:0;left:0;transition:all 0.5s ease;z-index:1;">
              {{/with}}

              <!-- Flash Overlay -->
              <div class="flash-overlay"
                style="position:absolute;top:0;left:0;width:100%;height:100%;background:white;opacity:0;z-index:3;pointer-events:none;">
              </div>
            </div>
            <div class="card-body px-0">
              <div class="d-grid justify-content-start mb-2 px-0">
                <h5 class="card-title mb-0 text-capitalize">{{this.name}}</h5>
                <div class="">
                  <span class="fw-light mt-1">${{this.price}}</span>
                </div>
              </div>
            </div>
          </div>
        </a>
        {{/each}}
      </div>
    </div>

</section>
{{/if}}


<!--SCRIPT-->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const mainImage = document.getElementById('main-product-image');
    const thumbnails = document.querySelectorAll('.thumbnail-image');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    let currentIndex = 0;

    // Get all image URLs and IDs
    const images = Array.from(thumbnails).map(thumb => ({
      url: thumb.dataset.fullImage,
      id: thumb.dataset.imageId
    }));

    // Initialize current index
    if (images.length > 0) {
      currentIndex = images.findIndex(img => img.id === mainImage.dataset.imageId);
      if (currentIndex === -1) currentIndex = 0;
    }

    // Thumbnail click handler
    thumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function () {
        updateMainImage(this.dataset.fullImage, this.dataset.imageId);
        currentIndex = images.findIndex(img => img.id === this.dataset.imageId);
      });
    });

    // Previous button handler
    prevBtn.addEventListener('click', function () {
      if (images.length === 0) return;
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      updateMainImage(images[currentIndex].url, images[currentIndex].id);
    });

    // Next button handler
    nextBtn.addEventListener('click', function () {
      if (images.length === 0) return;
      currentIndex = (currentIndex + 1) % images.length;
      updateMainImage(images[currentIndex].url, images[currentIndex].id);
    });

    function updateMainImage(src, id) {
      mainImage.src = src;
      mainImage.dataset.imageId = id;

      // Update active thumbnail
      thumbnails.forEach(t => t.classList.remove('active-thumbnail'));
      const activeThumb = Array.from(thumbnails).find(t => t.dataset.imageId === id);
      if (activeThumb) activeThumb.classList.add('active-thumbnail');
    }
  });
</script>